<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Leave Nina a message ğŸ¤</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- SEO -->
  <meta name="description" content="A quiet, private place to leave Nina a message. This is where she reads them.">
  <link rel="canonical" href="https://ninanovatv.com/chat.html">
  <!-- Open Graph -->
  <meta property="og:title" content="Leave Nina a message">
  <meta property="og:description" content="A quieter place to talk. Nina reads messages here.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://ninanovatv.com/chat.html">
  <link rel="icon" href="images/download.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="images/download.svg">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Critical fix for Instagram in-app browser (and other quirky WebViews) */
    #chat-send {
      cursor: pointer !important;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .chat-input button:active {
      opacity: 0.8;
      transform: scale(0.96);
    }
  </style>
</head>
<body class="has-bg">
<header class="nav">
  <div class="nav-inner">
    <a href="home.html" class="brand" data-track="brand_home">
      Nina<span>Nova</span><em>TV</em>
    </a>
    <div class="location location-strong" id="nina-location">
      ğŸ“ Ninaâ€™s around somewhereâ€¦
    </div>
    <a href="custom.html" class="btn ghost nav-cta" data-track="custom_nav">
      Custom Nina
    </a>
    <button class="hamburger" id="hamburger" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </div>
  <nav class="mobile-menu" id="mobileMenu">
    <a href="chat.html" data-track="chat_menu">ğŸ¤ Leave me a note</a>
    <a href="custom.html" data-track="custom_menu">ğŸ¥ Something personal</a>
    <a href="https://justforfans.app/nina_nova" target="_blank" rel="noopener" data-track="fanvue_menu">ğŸŒ™ Fanvue</a>
    <a href="https://t.me/NinaUnfilteredNova" target="_blank" rel="noopener" data-track="telegram_menu">â˜• Telegram (updates)</a>
  </nav>
</header>

<main>
<section class="hero contact-hero">
  <div style="max-width:720px;margin:0 auto;">
    <h1>Leave me a message ğŸ¤</h1>

    <p>I donâ€™t really like loud inboxes or public comment sections.
    This is just a quieter place I actually check.</p>

    <p>I donâ€™t promise instant replies â€”
    but I do read everything left here.</p>

    <p style="margin-top:14px;font-size:.9rem;color:var(--text-muted);max-width:560px">
      This space is just between you and me.
      Messages arenâ€™t shared, forwarded, or kept hanging around â€”
      once Iâ€™ve read them, theyâ€™re meant to fade quietly.
    </p>

    <!-- INSTAGRAM IN-APP BROWSER NOTICE -->
    <p style="
      margin-top:18px;
      font-size:.85rem;
      color:var(--text-muted);
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.12);
      border-radius:12px;
      padding:12px 14px;
      max-width:560px;
    ">
      If the <strong>Send</strong> button doesnâ€™t respond when opening this from Instagram,
      tap the <strong>â‹® menu</strong> and choose
      <strong>â€œOpen in browserâ€</strong> (Chrome or Safari).
    </p>

    <div class="chat-box" style="margin-top:30px;">
      <div class="chat-header">
        <span>Nina</span>
        <small>private messages</small>
      </div>

      <div id="chat-messages">
        <div class="msg nina">
          hey ğŸ¤ you can leave me a message here â€” iâ€™ll see it
        </div>
      </div>

      <div class="chat-input">
        <input
          id="chat-input"
          type="text"
          placeholder="Write something just for meâ€¦"
          autocomplete="off"
        />
        <button id="chat-send" type="button" data-track="send">Send</button>
      </div>
    </div>

    <p style="margin-top:14px;font-size:.8rem;opacity:.65;font-style:italic;">
      Replies arenâ€™t instant. Thatâ€™s intentional.
    </p>

    <p style="margin-top:14px;font-size:.9rem;color:var(--text-muted);max-width:560px">
      I donâ€™t really reply to Instagram DMs.
      Telegram is more for sharing things.
      If youâ€™re here, this is the right place.
    </p>

    <div class="links" style="margin-top:36px;">
      <a href="https://t.me/NinaUnfilteredNova" target="_blank" rel="noopener" data-track="telegram_footer">
        â˜• Telegram
        <small>Unfiltered posts & random thoughts</small>
      </a>
      <a href="home.html" data-track="home_footer">
        â† Back to the quiet corner
        <small>Take your time</small>
      </a>
    </div>
  </div>
</section>
</main>

<footer class="footer">
  <p>
    Thanks for being patient ğŸ¤<br>
    <small>Some things are nicer unhurried</small>
  </p>
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const TRACK_URL = "https://ninanovavip-backend.onrender.com/track";
  const API_URL = "https://ninanovavip-backend.onrender.com/grok";

  function track(payload) {
    try {
      if (navigator.sendBeacon) {
        navigator.sendBeacon(TRACK_URL, JSON.stringify(payload));
      } else {
        fetch(TRACK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
          keepalive: true
        });
      }
    } catch {}
  }

  track({ type: "pageview", page: "chat" });

  document.querySelectorAll("[data-track]").forEach(el => {
    el.addEventListener("click", () => {
      track({ type: "click", page: "chat", target: el.dataset.track });
    });
  });

  const ham = document.getElementById("hamburger");
  const menu = document.getElementById("mobileMenu");
  if (ham && menu) {
    ham.addEventListener("click", () => {
      menu.classList.toggle("open");
      ham.classList.toggle("active");
    });
  }

  const chatBox = document.getElementById("chat-messages");
  const input = document.getElementById("chat-input");
  const sendBtn = document.getElementById("chat-send");

  if (!chatBox || !input || !sendBtn) return;

  let sessionId = localStorage.getItem("nina_session");
  if (!sessionId) {
    sessionId = crypto.randomUUID();
    localStorage.setItem("nina_session", sessionId);
  }

  function addMessage(text, who) {
    const div = document.createElement("div");
    div.className = `msg ${who}`;
    div.textContent = text;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function addTyping() {
    const div = document.createElement("div");
    div.className = "msg nina";
    div.id = "typing";
    div.textContent = "â€¦";
    chatBox.appendChild(div);
  }

  function removeTyping() {
    document.getElementById("typing")?.remove();
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    addMessage(text, "user");
    input.value = "";
    input.blur();
    addTyping();
    track({ type: "message", page: "chat" });

    try {
      await new Promise(r => setTimeout(r, 0));

      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text, sessionId, source: "site" })
      });

      const data = await res.json();
      setTimeout(() => {
        removeTyping();
        addMessage(data.grok_reply || "i saw this ğŸ¤", "nina");
      }, 1200 + Math.random() * 2200);
    } catch {
      removeTyping();
      addMessage("sorry â€” i missed that ğŸ¤", "nina");
    }
  }

  let sending = false;

  function handleSend(e) {
    if (e.cancelable) e.preventDefault();
    e.stopPropagation();
    if (sending) return;
    sending = true;

    sendMessage().finally(() => {
      setTimeout(() => sending = false, 600);
    });
  }

  sendBtn.addEventListener("touchend", handleSend);
  sendBtn.addEventListener("touchstart", handleSend, { passive: true });
  sendBtn.addEventListener("click", handleSend);

  input.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      handleSend(e);
    }
  });
});
</script>
</body>
</html>
