<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Nina Nova TV — Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Favicon -->
  <link rel="icon" href="images/download.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="images/download.svg">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Inter+Tight:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family:'Inter Tight',system-ui,sans-serif;
      background:#07070b;
      color:#f4f4f8;
      height:100vh;
      overflow:hidden;
    }

    header{
      height:54px;
      display:flex;
      align-items:center;
      padding:0 18px;
      background:rgba(10,10,16,.85);
      border-bottom:1px solid rgba(255,255,255,.08);
      backdrop-filter:blur(12px);
      position:fixed;
      top:0;
      left:0;
      right:0;
      z-index:10;
    }

    header .brand{
      font-family:'Anton',sans-serif;
      font-size:1.4rem;
      letter-spacing:.5px;
    }

    header .brand span{color:#ff4fa0}
    header .brand em{
      font-style:normal;
      color:#ff8c32;
      font-size:.9em;
      margin-left:2px;
    }

    #wrapper{
      display:flex;
      height:100%;
      padding-top:54px;
    }

    /* LEFT: SESSION LIST */
    #sessions{
      width:340px;
      background:#0f0f18;
      border-right:1px solid rgba(255,255,255,.08);
      overflow-y:auto;
    }

    .session{
      padding:16px 18px;
      border-bottom:1px solid rgba(255,255,255,.06);
      cursor:pointer;
      transition:.2s ease;
    }

    .session:hover{
      background:#161622;
    }

    .session strong{
      display:block;
      font-size:.9rem;
      font-weight:700;
    }

    .session small{
      display:block;
      margin-top:4px;
      font-size:.75rem;
      opacity:.6;
    }

    /* RIGHT: CHAT */
    #chat{
      flex:1;
      padding:24px;
      overflow-y:auto;
      background:
        radial-gradient(420px 320px at 20% 20%, rgba(255,79,160,.08), transparent 60%),
        radial-gradient(420px 320px at 80% 20%, rgba(161,43,255,.08), transparent 60%);
    }

    .msg{
      margin-bottom:16px;
      max-width:70%;
      padding:12px 16px;
      border-radius:14px;
      line-height:1.45;
      font-size:.95rem;
      animation:fadeIn .2s ease both;
    }

    .user{
      margin-left:auto;
      background:#2b2b3f;
    }

    .assistant{
      background:#412060;
    }

    .time{
      display:block;
      font-size:.65rem;
      opacity:.5;
      margin-top:6px;
    }

    @keyframes fadeIn{
      from{opacity:0}
      to{opacity:1}
    }

    /* SCROLLBARS */
    #sessions::-webkit-scrollbar,
    #chat::-webkit-scrollbar{
      width:6px;
    }

    #sessions::-webkit-scrollbar-thumb,
    #chat::-webkit-scrollbar-thumb{
      background:rgba(255,79,160,.35);
      border-radius:6px;
    }
  </style>
</head>

<body>

<header>
  <div class="brand">
    Nina<span>Nova</span><em>TV</em> — Admin
  </div>
</header>

<div id="wrapper">
  <div id="sessions"></div>
  <div id="chat">Select a conversation</div>
</div>

<script>
const params = new URLSearchParams(location.search);
const ADMIN_KEY = params.get("key");

if (!ADMIN_KEY) {
  document.body.innerHTML = "<h2 style='padding:40px'>Missing admin key</h2>";
  throw new Error("No key");
}

fetch(`https://ninanovavip-backend.onrender.com/admin/conversations?key=${ADMIN_KEY}`)
  .then(res => {
    if (!res.ok) throw new Error("unauthorised");
    return res.json();
  })
  .then(data => {
    const sessionsEl = document.getElementById("sessions");
    const chatEl = document.getElementById("chat");

    Object.entries(data).forEach(([id, messages]) => {
      const div = document.createElement("div");
      div.className = "session";
      div.innerHTML = `
        <strong>${id}</strong>
        <small>${messages.length} messages</small>
      `;

      div.onclick = () => {
        chatEl.innerHTML = messages.map(m => `
          <div class="msg ${m.role}">
            ${m.content}
            <span class="time">${new Date(m.time).toLocaleString()}</span>
          </div>
        `).join("");
      };

      sessionsEl.appendChild(div);
    });
  })
  .catch(() => {
    document.body.innerHTML = "<h2 style='padding:40px'>Access denied</h2>";
  });
</script>

</body>
</html>
