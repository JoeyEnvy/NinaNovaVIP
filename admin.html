<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Nina Nova TV — Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="icon" href="images/download.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="images/download.svg">

  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Inter+Tight:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family:'Inter Tight',system-ui,sans-serif;
      background:#07070b;
      color:#f4f4f8;
      height:100vh;
      overflow:hidden;
    }

    header{
      height:54px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 18px;
      background:rgba(10,10,16,.85);
      border-bottom:1px solid rgba(255,255,255,.08);
      backdrop-filter:blur(12px);
      position:fixed;
      top:0;left:0;right:0;
      z-index:10;
    }

    header .brand{
      font-family:'Anton',sans-serif;
      font-size:1.4rem;
    }

    header span{color:#ff4fa0}
    header em{font-style:normal;color:#ff8c32}

    header nav button{
      background:none;
      border:none;
      color:#fff;
      font-weight:700;
      cursor:pointer;
      opacity:.7;
      margin-left:14px;
    }

    header nav button.active{opacity:1}

    #wrapper{
      display:flex;
      height:100%;
      padding-top:54px;
    }

    #sessions{
      width:320px;
      background:#0f0f18;
      border-right:1px solid rgba(255,255,255,.08);
      overflow-y:auto;
    }

    .session{
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.06);
      cursor:pointer;
    }

    .session:hover{background:#161622}

    #main{
      flex:1;
      padding:24px;
      overflow-y:auto;
    }

    .msg{
      margin-bottom:12px;
      padding:10px 14px;
      border-radius:14px;
      max-width:70%;
    }

    .user{margin-left:auto;background:#2b2b3f}
    .assistant{background:#412060}

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:20px;
    }

    th,td{
      text-align:left;
      padding:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      font-size:.9rem;
    }

    th{opacity:.7}
  </style>
</head>

<body>

<header>
  <div class="brand">Nina<span>Nova</span><em>TV</em> — Admin</div>
  <nav>
    <button id="tabChat" class="active">Chats</button>
    <button id="tabAnalytics">Analytics</button>
  </nav>
</header>

<div id="wrapper">
  <div id="sessions"></div>
  <div id="main">Loading…</div>
</div>

<script>
const params = new URLSearchParams(location.search);
const KEY = params.get("key");

if (!KEY) {
  document.body.innerHTML = "<h2 style='padding:40px'>Missing admin key</h2>";
  throw new Error("No key");
}

const sessionsEl = document.getElementById("sessions");
const mainEl = document.getElementById("main");

const tabChat = document.getElementById("tabChat");
const tabAnalytics = document.getElementById("tabAnalytics");

tabChat.onclick = () => loadChats();
tabAnalytics.onclick = () => loadAnalytics();

function setTab(active){
  tabChat.classList.toggle("active", active==="chat");
  tabAnalytics.classList.toggle("active", active==="analytics");
}

function loadChats(){
  setTab("chat");
  fetch(`https://ninanovavip-backend.onrender.com/admin/conversations?key=${KEY}`)
    .then(r => r.json())
    .then(data => {
      sessionsEl.innerHTML = "";
      mainEl.innerHTML = "Select a conversation";
      Object.entries(data).forEach(([id, msgs]) => {
        const div = document.createElement("div");
        div.className = "session";
        div.textContent = `${id} (${msgs.length})`;
        div.onclick = () => {
          mainEl.innerHTML = msgs.map(m =>
            `<div class="msg ${m.role}">${m.content}</div>`
          ).join("");
        };
        sessionsEl.appendChild(div);
      });
    });
}

function loadAnalytics(){
  setTab("analytics");
  sessionsEl.innerHTML = "";
  mainEl.innerHTML = "Loading analytics…";

  fetch(`https://ninanovavip-backend.onrender.com/admin/analytics?key=${KEY}`)
    .then(r => r.json())
    .then(events => {
      const counts = {};
      events.forEach(e => {
        const k = `${e.page} → ${e.target || e.type}`;
        counts[k] = (counts[k] || 0) + 1;
      });

      mainEl.innerHTML = `
        <h2>Analytics</h2>
        <table>
          <tr><th>Event</th><th>Count</th></tr>
          ${Object.entries(counts)
            .map(([k,v]) => `<tr><td>${k}</td><td>${v}</td></tr>`)
            .join("")}
        </table>
      `;
    });
}

loadChats();
</script>

</body>
</html>
