<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Nina Nova — Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    * { box-sizing:border-box; margin:0; padding:0 }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      display:flex;
      height:100vh;
      background:#0b0b12;
      color:#eee;
    }

    #sessions {
      width:320px;
      border-right:1px solid #222;
      overflow-y:auto;
      background:#0f0f18;
    }

    .session {
      padding:14px 16px;
      border-bottom:1px solid #1e1e2e;
      cursor:pointer;
    }

    .session:hover {
      background:#1a1a2a;
    }

    .session strong {
      display:block;
      font-size:.85rem;
      opacity:.9;
    }

    .session small {
      opacity:.6;
      font-size:.75rem;
    }

    #chat {
      flex:1;
      padding:20px;
      overflow-y:auto;
    }

    .msg {
      margin-bottom:14px;
      max-width:75%;
      line-height:1.4;
      padding:10px 14px;
      border-radius:14px;
      font-size:.95rem;
    }

    .user {
      background:#2b2b3f;
      margin-left:auto;
    }

    .assistant {
      background:#412060;
    }

    .time {
      display:block;
      font-size:.65rem;
      opacity:.5;
      margin-top:4px;
    }

    header {
      position:fixed;
      top:0;
      left:0;
      right:0;
      height:48px;
      background:#090910;
      border-bottom:1px solid #222;
      display:flex;
      align-items:center;
      padding:0 16px;
      z-index:10;
    }

    header strong {
      font-size:.9rem;
    }

    #wrapper {
      display:flex;
      width:100%;
      padding-top:48px;
    }
  </style>
</head>

<body>

<header>
  <strong>Nina Nova — Admin Panel</strong>
</header>

<div id="wrapper">
  <div id="sessions"></div>
  <div id="chat">Select a conversation</div>
</div>

<script>
const params = new URLSearchParams(location.search);
const ADMIN_KEY = params.get("key");

if (!ADMIN_KEY) {
  document.body.innerHTML = "<h2 style='padding:40px'>Missing admin key</h2>";
  throw new Error("No key");
}

fetch(`https://ninanovavip-backend.onrender.com/admin/conversations?key=${ADMIN_KEY}`)
  .then(res => {
    if (!res.ok) throw new Error("unauthorised");
    return res.json();
  })
  .then(data => {
    const sessionsEl = document.getElementById("sessions");
    const chatEl = document.getElementById("chat");

    Object.entries(data).forEach(([id, messages]) => {
      const div = document.createElement("div");
      div.className = "session";
      div.innerHTML = `
        <strong>${id}</strong>
        <small>${messages.length} messages</small>
      `;

      div.onclick = () => {
        chatEl.innerHTML = messages.map(m => `
          <div class="msg ${m.role}">
            ${m.content}
            <span class="time">${new Date(m.time).toLocaleString()}</span>
          </div>
        `).join("");
      };

      sessionsEl.appendChild(div);
    });
  })
  .catch(err => {
    document.body.innerHTML = "<h2 style='padding:40px'>Access denied</h2>";
  });
</script>

</body>
</html>
